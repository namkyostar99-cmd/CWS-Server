{% extends 'layout.html' %}

{% block title %}CCTV ê´€ì œì‹¤ - ëª¨ë‹ˆí„°ë§{% endblock %}

{% block sidebar_extra %}
<section class="status">
    <h4>âœ’ï¸ ìƒíƒœ ë° ê¸°ë¡</h4>
    <div class="status-subtitle">ì‹ í˜¸ë“± ì „ê´‘íŒ</div>
    <div class="signal-board" id="signalBoard" data-state="RED">RED</div>
    <div class="violation-wrap">
        <div class="violation-title">ìœ„ë°˜ ë‚´ì—­</div>
        <div class="violation-list" id="violationList">
            {% if violations %}
                {% for v in violations[:5] %}
                <div class="violation-item">[{{ v.timestamp }}] ID: {{ v.track_id }} ê°ì§€</div>
                {% endfor %}
            {% else %}
                <div class="violation-item">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<div class="page" id="live">
    <h2>ğŸ“º ì‹¤ì‹œê°„ í™”ë©´</h2>
    <div class="video-card">
        <div class="video-frame" id="videoFrame">
            <img id="video-feed" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" alt="video feed" />
            <div class="video-placeholder">ì˜ìƒ ìŠ¤íŠ¸ë¦¼ í‘œì‹œ ì˜ì—­</div>
            <button id="uploadTrigger" class="upload-trigger" title="ì˜ìƒ/ì¹´ë©”ë¼ ì—…ë¡œë“œ" aria-label="ì˜ìƒ/ì¹´ë©”ë¼ ì—…ë¡œë“œ">ğŸ¥</button>
        </div>
        <div class="roi-info" id="roiInfo">
            <div>ì¢Œí‘œ ë¡œê·¸</div>
            <pre id="roiLog" class="roi-log">(í´ë¦­ ì¢Œí‘œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤)</pre>
        </div>
        <div id="roiControls" class="roi-controls">
            <button id="roiStart" class="btn primary">ROI ì„¤ì • ì‹œì‘</button>
            <button id="roiReset" class="btn">ì´ˆê¸°í™”</button>
            <button id="roiDone" class="btn">ì„¤ì • ì™„ë£Œ</button>
        </div>
        <div class="upload-section">
            <div class="upload-row">
                <input id="videoUploader" type="file" accept="image/*,video/*" class="upload-input" />
            </div>
        </div>
    </div>
</div>

<div class="page hidden" id="overview">
    <h2>ğŸ¥ CCTV ê´€ì œì‹¤</h2>
    <div class="cards">
        <div class="card">ì¹´ë©”ë¼<br/><span class="big">12</span></div>
        <div class="card">ì•ŒëŒ<br/><span class="big">{{ violations|length }}</span></div>
        <div class="card">ì—°ê²° ìƒíƒœ<br/><span class="big">Good</span></div>
    </div>
</div>

<div class="page hidden" id="playback">
    <h2>ğŸš¨ ìœ„ë°˜ ì°¨ëŸ‰ ì¡°íšŒ</h2>
    <div class="playback-grid" id="playbackGrid">
        {% if violations %}
            {% for v in violations %}
            <div class="playback-card">
                <div class="playback-img">
                    {% if v.url %}
                        <img src="{{ v.url }}" alt="Violation" style="width:100%; border-radius:4px;">
                    {% else %}
                        ì°¨ëŸ‰ ì´ë¯¸ì§€
                    {% endif %}
                </div>
                <div class="playback-info">
                    <div class="playback-title">ìœ„ë°˜ ê°ì§€ (ID: {{ v.track_id }})</div>
                    <div class="playback-meta">íŒŒì¼ëª…: {{ v.filename }}</div>
                    <div class="playback-meta">ì‹œê°„: {{ v.timestamp }}</div>
                    <div class="playback-meta">ìœ„ì¹˜: ê´€ì œêµ¬ì—­</div>
                    {% if v.url %}
                    <div class="playback-meta">
                        <a href="{{ v.url }}" target="_blank" style="color: #ffcc00; text-decoration: underline;">[ì¦ê±° í™•ì¸]</a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p style="color: white; padding: 20px;">ê²€ìƒ‰ëœ ìœ„ë°˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>
</div>

<div class="page hidden" id="settings">
    <h2>âš™ï¸ ì„¤ì •</h2>
    <label>ì„œë²„ ì£¼ì†Œ<br/><input type="text" id="serverAddr" value="rtsp://example"/></label>
    <label>í•´ìƒë„<br/>
        <select id="resolution"><option>1080p</option><option>720p</option><option>480p</option></select>
    </label>
</div>
{% endblock %}