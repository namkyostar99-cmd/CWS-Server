{% extends 'layout.html' %}

{% block content %}
<div class="page" id="overview">
    <div class="stats-container" style="margin-bottom: 20px;">
        <h3 style="color: #fff;">ğŸ“Š ì‹¤ì‹œê°„ í†µê³„: <span id="violationCount" style="color: #ff4757;">{{ violations|length }}</span> ê±´ ê°ì§€ë¨</h3>
    </div>

    <div class="video-card" style="margin-bottom: 20px;">
        <div class="video-frame" style="background: #000; border-radius: 8px; overflow: hidden; position: relative; min-height: 450px;">
            <video id="video-feed" src="{{ current_stream }}" controls autoplay muted style="width: 100%; height: 100%;"></video>
            <div id="stream-overlay" style="position: absolute; top: 10px; left: 10px; color: #00ff00; font-size: 0.8rem; background: rgba(0,0,0,0.5); padding: 2px 5px;">LIVE FEED</div>
        </div>
    </div>

    <div class="card" style="background: #2a2a2a; border: 1px solid #444;">
        <h3 style="margin-top: 0; color: white;">ğŸŒ ìŠ¤íŠ¸ë¦¬ë° ì„¤ì •</h3>
        <div style="display: flex; gap: 10px;">
            <select id="urlSelectBox" style="flex: 1; padding: 10px; border-radius: 4px; background: #1a1a1a; color: white; border: 1px solid #555;">
                <option value="{{ current_stream }}">í˜„ì¬ ì£¼ì†Œ (ê¸°ë³¸ê°’)</option>
                </select>
            <button id="updateUrlBtn" class="btn primary">URL ê°±ì‹ </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    // URL ê°±ì‹  ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('updateUrlBtn').addEventListener('click', () => {
        const selectedUrl = document.getElementById('urlSelectBox').value;
        fetch('/api/set_stream', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ url: selectedUrl })
        }).then(() => location.reload());
    });
</script>
{% endblock %}